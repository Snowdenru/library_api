# Техническое задание на разработку RESTful API для управления библиотечным каталогом

## 1. Введение

### 1.1. Назначение документа
Документ описывает технические требования к разработке RESTful API для управления библиотечным каталогом.

### 1.2. Цель проекта
Создание веб-приложения для управления библиотечным каталогом с возможностью выполнения CRUD-операций над книгами и их поиска.

## 2. Технические требования

### 2.1. Общие требования
- Язык программирования: Python ≥ 3.10
- Веб-фреймворк: Aiohttp ≥ 3.8
- База данных: PostgreSQL
- Пакетный менеджер: pip (предпочтительно Poetry)
- Система контроля версий: Git
- Клиентская часть: Bootstrap 5 (HTML/CSS/JavaScript) или тестирование через Postman

### 2.2. Рекомендуемые технологии
- Использование Poetry для управления зависимостями
- Развертывание с помощью docker-compose

## 3. Функциональные требования

### 3.1. Модуль управления книгами (CRUD)
- **Создание книги**:
  - Название (обязательное)
  - Автор(ы) (обязательное)
  - Жанр(ы)
  - Год издания
  - ISBN (опционально)
  - Количество экземпляров
  - Статус доступности

- **Чтение книги**:
  - Получение полной информации о книге по ID
  - Получение списка всех книг с пагинацией

- **Обновление книги**:
  - Изменение любых атрибутов существующей книги

- **Удаление книги**:
  - Мягкое удаление (изменение статуса)
  - Или полное удаление из БД

### 3.2. Модуль поиска книг
- Поиск по:
  - Названию (частичное совпадение)
  - Автору (частичное совпадение)
  - Жанру (точное совпадение)
  - Году издания (диапазон)
  - ISBN (точное совпадение)
- Сортировка результатов по:
  - Названию
  - Автору
  - Году издания
- Пагинация результатов

### 3.3. Дополнительные возможности
- Фильтрация по доступности книги
- Получение статистики:
  - Количество книг по жанрам
  - Количество книг по авторам

## 4. API Endpoints

### 4.1. Книги
- `GET /api/books` - список всех книг
- `POST /api/books` - создание новой книги
- `GET /api/books/{id}` - получение книги по ID
- `PUT /api/books/{id}` - обновление книги
- `DELETE /api/books/{id}` - удаление книги
- `GET /api/books/search` - поиск книг

### 4.2. Статистика
- `GET /api/stats/genres` - статистика по жанрам
- `GET /api/stats/authors` - статистика по авторам

## 5. Структура проекта

```
library_api/
├── docker-compose.yml
├── .env.example
├── .gitignore
├── pyproject.toml
├── README.md
├── src/
│   ├── main.py
│   ├── models/
│   │   ├── book.py
│   │   └── database.py
│   ├── routes/
│   │   ├── books.py
│   │   └── stats.py
│   ├── services/
│   │   ├── book_service.py
│   │   └── search_service.py
│   └── utils/
│       ├── config.py
│       └── exceptions.py
└── tests/
    ├── unit/
    └── integration/
```

## 6. Требования к БД

### 6.1. Таблицы
- **books**:
  - id (PK)
  - title
  - publication_year
  - isbn (nullable)
  - copies_available
  - is_active

- **authors**:
  - id (PK)
  - name

- **genres**:
  - id (PK)
  - name

- **book_authors** (связь many-to-many):
  - book_id (FK)
  - author_id (FK)

- **book_genres** (связь many-to-many):
  - book_id (FK)
  - genre_id (FK)

## 7. Требования к репозиторию

- Использование веток (main/develop/feature-*)
- Осмысленные сообщения коммитов
- Наличие README с инструкциями по установке и запуску
- Наличие .gitignore
- Документация API (Swagger/OpenAPI или аналог)

## 8. Развертывание

### 8.1. Локальная разработка
1. Установить Python 3.10+
2. Установить Poetry
3. Клонировать репозиторий
4. Установить зависимости: `poetry install`
5. Настроить БД PostgreSQL
6. Запустить приложение: `poetry run python src/main.py`

### 8.2. Docker-развертывание
1. Установить Docker и docker-compose
2. Клонировать репозиторий
3. Запустить: `docker-compose up --build`

## 9. Критерии приемки

- Все CRUD-операции работают корректно
- Поиск возвращает корректные результаты
- API покрыто тестами (≥80% coverage)
- Документация по API доступна
- Проект можно развернуть по инструкции
- Код соответствует PEP8

## 10. Дополнительные рекомендации

- Использование asyncpg для работы с PostgreSQL
- Валидация данных с помощью Pydantic
- Логирование операций
- Обработка ошибок с возвращением соответствующих HTTP-статусов
- Конфигурация через переменные окружения