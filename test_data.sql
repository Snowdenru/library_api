-- Очистка существующих данных (осторожно!)
DELETE FROM book_genres;
DELETE FROM book_authors;
DELETE FROM genres;
DELETE FROM authors;
DELETE FROM books;

-- Сброс автоинкремента
UPDATE sqlite_sequence SET seq = 0 WHERE name IN ('books', 'authors', 'genres');

-- Добавление авторов
INSERT INTO authors (name) VALUES 
('Лев Толстой'),
('Фёдор Достоевский'),
('Антон Чехов'),
('Джордж Оруэлл'),
('Рэй Брэдбери'),
('Джоан Роулинг'),
('Стивен Кинг'),
('Агата Кристи'),
('Эрнест Хемингуэй'),
('Джек Лондон');

-- Добавление жанров
INSERT INTO genres (name) VALUES 
('Роман'),
('Классика'),
('Фантастика'),
('Детектив'),
('Ужасы'),
('Фэнтези'),
('Драма'),
('Приключения'),
('Антиутопия'),
('Научная литература');

-- Добавление книг
INSERT INTO books (title, publication_year, isbn, copies_available, is_active) VALUES
('Война и мир', 1869, '978-5-699-12014-7', 5, 1),
('Преступление и наказание', 1866, '978-5-17-067697-8', 3, 1),
('1984', 1949, '978-5-17-113626-1', 2, 1),
('451 градус по Фаренгейту', 1953, '978-5-17-090436-5', 4, 1),
('Гарри Поттер и философский камень', 1997, '978-5-389-07435-4', 6, 1),
('Оно', 1986, '978-5-17-090437-2', 1, 1),
('Убийство в Восточном экспрессе', 1934, '978-5-699-80631-5', 2, 1),
('Старик и море', 1952, '978-5-17-090438-9', 3, 1),
('Мартин Иден', 1909, '978-5-17-090439-6', 2, 1),
('Вишнёвый сад', 1904, '978-5-17-090440-2', 4, 1);

-- Связи книг с авторами
INSERT INTO book_authors (book_id, author_id) VALUES
(1, 1),   -- Война и мир - Толстой
(2, 2),   -- Преступление и наказание - Достоевский
(3, 4),   -- 1984 - Оруэлл
(4, 5),   -- 451 градус - Брэдбери
(5, 6),   -- Гарри Поттер - Роулинг
(6, 7),   -- Оно - Кинг
(7, 8),   -- Убийство в Восточном экспрессе - Кристи
(8, 9),   -- Старик и море - Хемингуэй
(9, 10),  -- Мартин Иден - Лондон
(10, 3);  -- Вишнёвый сад - Чехов

-- Связи книг с жанрами
INSERT INTO book_genres (book_id, genre_id) VALUES
(1, 1), (1, 2), (1, 7),   -- Война и мир: Роман, Классика, Драма
(2, 1), (2, 2), (2, 7),   -- Преступление и наказание: Роман, Классика, Драма
(3, 1), (3, 9),           -- 1984: Роман, Антиутопия
(4, 3), (4, 9),           -- 451 градус: Фантастика, Антиутопия
(5, 6),                   -- Гарри Поттер: Фэнтези
(6, 5), (6, 1),           -- Оно: Ужасы, Роман
(7, 4),                   -- Убийство в Восточном экспрессе: Детектив
(8, 1), (8, 7),           -- Старик и море: Роман, Драма
(9, 1), (9, 8),           -- Мартин Иден: Роман, Приключения
(10, 7);                  -- Вишнёвый сад: Драма

-- Тестовые SQL запросы

-- Проверка книг
SELECT b.id, b.title, a.name as author, b.copies_available 
FROM books b
JOIN book_authors ba ON b.id = ba.book_id
JOIN authors a ON ba.author_id = a.id
WHERE b.is_active = 1;

-- Проверка статистики по жанрам
SELECT g.name, COUNT(bg.book_id) as book_count
FROM genres g
LEFT JOIN book_genres bg ON g.id = bg.genre_id
GROUP BY g.name
ORDER BY book_count DESC;

-- Проверка поиска
SELECT b.title, a.name as author
FROM books b
JOIN book_authors ba ON b.id = ba.book_id
JOIN authors a ON ba.author_id = a.id
WHERE b.title LIKE '%мир%' OR a.name LIKE '%Толстой%';
